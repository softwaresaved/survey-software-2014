---
title: "AnonymisingSoftwareSurveyResultsMay15"
author: "Simon Hettrick, Olivier PHILIPPE"
date: "11 May 2015"
output: html_document
---

Description
-----------

This work is based on the results of the "The use of software in research" survey conducted by the survey was conducted by the Software Sustainability Institute from August to November 2014. For more information about the suvey, see the README packaged with this script.

This script anonymises the raw data collected from participants. First, each respondent is given a "Respondent_ID" which will be the identifier used to refer to specific results in the later data cleaning and data analysis scripts. Once the respondent ID has been given, the columns related to personal details are removed: specifically, the respondent's email address and their response to the question "Do you have any final comments?".

Script
---------------

Set the directory to the 
```{r echo=FALSE}
# Setting up the directory
(WD <- getwd())
if (!is.null(WD)) setwd(WD)
rm(WD)
```

Read all data into dataframes

```{r}
    dataSurvey <- read.csv('../data/rawSurveyData.csv')
	dataPetition <- read.csv("../data/rawPetitionData.csv")
	dataPhd <- read.csv("../data/rawPhdData.csv")
```
```{r}

```

Adding a new column for Respondent_ID and assign a random number for each respondent. The replace=FALSE is to avoid that the respondents will get the same numbers. Then transform that int() into a factor.

```{r}
	# data_with_personal_data <- data_raw
	#data_with_personal_data$Respondent_ID <- seq(from=1, to=nrow(data_raw))
	#data_with_personal_data$Respondent_ID <- sample(1:nrow(data_raw), replace=FALSE)
	#data_with_personal_data$Respondent_ID <- as.factor(data_with_personal_data$Respondent_ID)
	# Quick check to be sure that there is 419 unique ID generated 
	#length(unique(data_with_personal_data$Respondent_ID))

	#Remove columns that include identifying data (i.e. columns 18 and 19)
	personalInformation  <-  c("Do.you.have.any.final.comments.about.this.survey.or.the.use.of.software.in.research.","If.you.would.like.updates.on.the.progress.of.this.research..please.provide.your.email.address")
	dfSurveyAnon  <- dataSurvey[,!(names(dataSurvey) %in% personalInformation)]
	dfPhdAnon  <- dataPhd[,!(names(dataPhd) %in% personalInformation)]
	dfPetitionAnon  <- dataPetition[,!(names(dataPetition) %in% personalInformation)]
```

Rename columns names to have the same between all the dataset before merging

```{r}
	cleanColName <- c('Timestamp', 
					  'Q.1.Institution', 
					  'Q.2.Role', 
					  'Q.3.Discipline', 
					  'Q.4.Fund',
					  'Q.5.Seniority', 
					  'Q.6.Use.Software', 
					  'Q.7.Importance.Software',
					  'Q.8.Developing.Software', 
					  'Q.9.Training.Software', 
					  'Q.10.Cost.Software',
					  'Q.11.Main.Software', 
					  'E.1.Job.Title', 
					  'E.2.Gender', 
					  'E.3.Contract', 
					  'E.4.OS')

	colnames(dfSurveyAnon)  <- cleanColName
	colnames(dfPhdAnon)  <- cleanColName[c(1, 4, 5, 7, 8, 9, 10, 11, 12, 13, 14, 16)]

	names(dfPetitionAnon)[c(3:17)]  <- cleanColName[c(3:16, 2)] 
```

Adding a column on each dataset with the origin of the data

```{r}
	dfSurveyAnon$dataOrigin <- 'survey'
	dfPhdAnon$dataOrigin <- 'phd'
	dfPetitionAnon$dataOrigin <- 'petition'
```

Merging all datasets in one big file to save later

```{r}
	source('../sources/utils.R')
	mergedDf  <- rbindAllCol(dfSurveyAnon, dfPhdAnon, dfPetitionAnon)
```

Write data frames to CSVs


```{r}
	# #Data with personal data to CSV (row.names=FALSE stops that column from being written to the CSV)
	# write.csv(data_with_personal_data,"mergedDF.csv", row.names=FALSE)

	#Anonymised data to CSV (row.names=FALSE stops that column from being written to the CSV)
	write.csv(mergedDf,"../data/mergedDf.csv", row.names=FALSE)
```